<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CEREBRO — Method Transparency</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@300;400;500;600&family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{--black:#000;--deep:#040608;--stone:#0A0D12;--panel:#0E1219;--border:#1E2530;--gold:#C9A84C;--gold2:#E8C96A;--red:#E63946;--green:#2ECC71;--amber:#FF9F1C;--blue:#4A90D9;--white:#F0F2F5;--muted:#8892A4;--dim:#3D4A5C}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--deep);color:var(--white);font-family:'DM Sans',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse 120% 60% at 50% -10%,rgba(201,168,76,0.06) 0%,transparent 60%),linear-gradient(180deg,#040608 0%,#060910 40%,#040608 100%);pointer-events:none}
.everything{position:relative;z-index:1;max-width:900px;margin:0 auto;padding:48px 24px 80px}
h1{font-family:'Bebas Neue',sans-serif;font-size:48px;letter-spacing:0.08em;color:var(--gold);margin-bottom:8px}
.subtitle{font-family:'IBM Plex Mono',monospace;font-size:11px;letter-spacing:0.2em;color:var(--muted);margin-bottom:32px}
.method-section{background:var(--panel);border:1px solid var(--border);border-left:3px solid var(--gold);padding:24px 28px;margin-bottom:24px}
.method-section h2{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:0.1em;color:var(--gold);margin-bottom:16px}
.method-section p,.method-section li{font-size:14px;line-height:1.7;color:var(--white);margin-bottom:12px}
.method-section code{font-family:'IBM Plex Mono',monospace;font-size:12px;background:var(--stone);padding:2px 6px;border-radius:2px;color:var(--gold2)}
.method-section ul{margin-left:20px;margin-bottom:12px}
.back-link{display:inline-block;font-family:'IBM Plex Mono',monospace;font-size:11px;letter-spacing:0.1em;color:var(--gold);text-decoration:none;margin-bottom:24px}
.back-link:hover{color:var(--gold2);text-decoration:underline}
</style>
</head>
<body>
<div class="everything">
  <a href="index.html" class="back-link">← BACK TO CEREBRO</a>
  <h1>METHOD TRANSPARENCY</h1>
  <div class="subtitle">How the peak window is computed · Saddle detection · Confidence · Limitations</div>

  <div class="method-section">
    <h2>How the peak window is computed</h2>
    <p id="peakRule">Loading...</p>
  </div>

  <div class="method-section">
    <h2>What a saddle means mathematically</h2>
    <p id="saddleRule">Loading...</p>
    <p id="provenance">Loading...</p>
  </div>

  <div class="method-section">
    <h2>How confidence is computed</h2>
    <p>Calibrated confidence = 0.4×posterior_variance + 0.35×backtest_calibration + 0.25×sensor_integrity. Posterior from Kalman filter; backtest from coverage_80_calibrated; integrity from pipeline status. Stored in <code>cerebro_data/model_metrics.json</code>.</p>
  </div>

  <div class="method-section">
    <h2>State-space + hazard engine (Phase 2)</h2>
    <p id="engineProvenance">Loading...</p>
  </div>

  <div class="method-section">
    <h2>What historical analogues are used</h2>
    <p>Analogue library: US 1900–present. Event categories: redistribution (New Deal, Great Society), policy shift (Reagan, Crime Bill, 2008 financial crisis, 2020 COVID response). Stored in <code>cerebro_data/</code> and backtest artifact.</p>
  </div>

  <div class="method-section">
    <h2>Backtest results</h2>
    <p id="backtestResults">Loading...</p>
  </div>
  <div class="method-section">
    <h2>Code provenance</h2>
    <p id="codeProvenance">Loading...</p>
  </div>

  <div class="method-section">
    <h2>Limitations — what it does NOT predict</h2>
    <ul id="limitations"></ul>
  </div>
</div>
<script>
fetch('cerebro_data.json').then(r=>r.json()).then(d=>{
  const md=d.method_data||{}, bt=d.backtest_metrics||{}, bt2=d.backtest_metrics_v2||{}, mm=d.model_metrics||{}, p=md.provenance||{};
  document.getElementById('peakRule').textContent=md.peak_window_rule||'Peak year = now_year + weighted_median(Δt_i). Window = [now_year + weighted_p10, now_year + weighted_p90] (80% window).';
  document.getElementById('saddleRule').textContent=md.saddle_rule||'Saddle when |v| < v_thresh AND sign(a) opposes sign(v).';
  document.getElementById('provenance').innerHTML=`<strong>Thresholds:</strong> <code>v_thresh = ${p.v_thresh??0.15}</code>, <code>sign(a) opposes sign(v)</code> required. Saddle intensity combines velocity factor, acceleration magnitude, and Ring B (GSS/Pew attitudes).`;
  const dw=md.distance_weights||{},cal=md.conformal_calibration||{};
  document.getElementById('backtestResults').innerHTML=
    `<strong>N saddles tested:</strong> ${bt.n_saddles_tested??0}<br>
     <strong>MAE (years):</strong> ${bt.mae_years??'—'}<br>
     <strong>Median absolute error:</strong> ${bt.median_absolute_error_years??'—'} years<br>
     <strong>Worst-case error:</strong> ${bt.worst_case_error_years??'—'} years<br>
     <strong>Pinball q10/q90:</strong> ${bt.pinball_loss_q10??'—'} / ${bt.pinball_loss_q90??'—'}<br>
     <strong>Sharpness (80%):</strong> ${bt.sharpness_80_years??'—'} years<br>
     <strong>50% coverage (raw/calibrated):</strong> ${bt.coverage_50??'—'}% / ${bt.coverage_50_calibrated??'—'}%<br>
     <strong>80% coverage (raw/calibrated):</strong> ${bt.coverage_80??'—'}% / ${bt.coverage_80_calibrated??'—'}%<br>
     <strong>Event library:</strong> ${bt.event_library||'—'}`;
  document.getElementById('codeProvenance').innerHTML=
    `<strong>V_THRESH:</strong> ${p.v_thresh??0.15}<br>
     <strong>Distance weights (learned):</strong> vel=${dw.vel_weight??p.distance_vel_weight??100}, acc=${dw.acc_weight??p.distance_acc_weight??2500}<br>
     <strong>Interval quantiles:</strong> p${((p.quantile_lo??0.1)*100).toFixed(0)}–p${((p.quantile_hi??0.9)*100).toFixed(0)} (${p.window_label??'80% window'})<br>
     <strong>Conformal:</strong> ${cal?.s_hat!=null?'s_hat='+cal.s_hat+', alpha='+cal.alpha:'not applied'}`;
  const ss=md.state_space, haz=md.hazard, cp=md.changepoint, coup=md.coupling;
  let engineHtml='';
  if(ss)engineHtml+=`<strong>State-space:</strong> Kalman filter, posterior (p,v,a) ±σ. `;
  if(haz&&haz.prob_5y!=null)engineHtml+=`<strong>Hazard:</strong> P(5y)=${(haz.prob_5y*100).toFixed(0)}%, E[TTE]=${haz.expected_time_to_event_years??'—'} yr. `;
  if(cp)engineHtml+=`<strong>Changepoint:</strong> regime_shift=${(cp.regime_shift_probability*100).toFixed(0)}%, last_change=${cp.last_change_estimate??'—'}. `;
  if(coup)engineHtml+=`<strong>Coupling:</strong> Class×Harm, Harm×Evil cross-terms.`;
  document.getElementById('engineProvenance').innerHTML=engineHtml||'State-space/hazard/changepoint not yet run.';
  if(bt2&&bt2.mae_event_timing_years!=null)document.getElementById('backtestResults').innerHTML+=`<br><strong>Validation v2 (rolling-origin):</strong> MAE=${bt2.mae_event_timing_years} yr, Brier=${bt2.brier_score_event_5y??'—'}, coverage_80=${bt2.coverage_80_pct??'—'}%`;
  if(mm&&mm.confidence_pct!=null)document.getElementById('backtestResults').innerHTML+=`<br><strong>Calibrated confidence:</strong> ${mm.confidence_pct}%`;
  const lim=md.limitations||[];
  document.getElementById('limitations').innerHTML=lim.map(l=>`<li>${l}</li>`).join('');
}).catch(()=>{
  document.getElementById('peakRule').textContent='Peak year = now_year + weighted_median(Δt_i). Window = [now_year + weighted_p10, now_year + weighted_p90] (80% window). Δt_i = event_year_i − saddle_year_i. Weight w_i = 1/(1 + distance).';
  document.getElementById('saddleRule').textContent='Saddle when |v| < 0.15 AND sign(a) opposes sign(v).';
  document.getElementById('backtestResults').textContent='Run cerebro_backtest.py and redeploy to load backtest metrics.';
  document.getElementById('codeProvenance').textContent='V_THRESH=0.15, distance_vel_weight=100, distance_acc_weight=2500, quantiles p10–p90 (80% window).';
});
</script>
</body>
</html>
